"""
가상 데이터베이스 (Mock Database)
- 대학별 입시 자료 (입학처 제공 자료)
- 전국 대학 수시/정시 합격 데이터
"""

# ============================================================
# 대학별 입학처 자료 (대학별 Agent가 사용)
# ============================================================

UNIVERSITY_DATA = {
    "서울대": {
        "모집요강": {
            "2026학년도": {
                "수시": {
                    "지역균형전형": {
                        "모집인원": 756,
                        "지원자격": "고교 추천 2명 이내, 국내 고교 졸업(예정)자",
                        "전형방법": "서류평가 100% (학생부, 자소서 폐지)",
                        "수능최저": "3개 영역 등급합 7 이내 (탐구 2과목 평균)"
                    },
                    "일반전형": {
                        "모집인원": 1523,
                        "지원자격": "국내외 고교 졸업(예정)자 또는 동등 학력자",
                        "전형방법": "1단계: 서류 100% (2배수) / 2단계: 서류 50% + 면접 50%",
                        "수능최저": "없음"
                    },
                    "기회균형전형": {
                        "모집인원": 350,
                        "지원자격": "기초생활수급자, 차상위계층, 농어촌 등",
                        "전형방법": "서류평가 100%",
                        "수능최저": "3개 영역 등급합 9 이내"
                    }
                },
                "정시": {
                    "일반전형": {
                        "모집인원": 1090,
                        "전형방법": "수능 100% (일부 학과 면접)",
                        "수능반영": "국어 33.3%, 수학 40%, 영어 등급별 가산점, 탐구 26.7%",
                        "교과평가": "2026학년도부터 도입, 감점 방식"
                    }
                }
            }
        },
        "입결": {
            "2025학년도": {
                "수시": {
                    "지역균형전형": {
                        "인문대학": {"평균내신": 1.8, "경쟁률": 2.8},
                        "사회과학대학": {"평균내신": 1.6, "경쟁률": 3.2},
                        "자연과학대학": {"평균내신": 1.9, "경쟁률": 2.5},
                        "공과대학": {"평균내신": 1.7, "경쟁률": 3.5},
                        "경영대학": {"평균내신": 1.4, "경쟁률": 4.1}
                    },
                    "일반전형": {
                        "인문대학": {"평균내신": 1.5, "경쟁률": 5.2},
                        "사회과학대학": {"평균내신": 1.3, "경쟁률": 6.8},
                        "자연과학대학": {"평균내신": 1.6, "경쟁률": 4.5},
                        "공과대학": {"평균내신": 1.4, "경쟁률": 7.2},
                        "경영대학": {"평균내신": 1.2, "경쟁률": 9.5}
                    }
                },
                "정시": {
                    "인문대학": {"평균백분위": 97.5, "경쟁률": 2.1},
                    "사회과학대학": {"평균백분위": 98.2, "경쟁률": 2.8},
                    "자연과학대학": {"평균백분위": 96.8, "경쟁률": 1.9},
                    "공과대학": {"평균백분위": 97.8, "경쟁률": 2.5},
                    "경영대학": {"평균백분위": 98.8, "경쟁률": 3.2}
                }
            }
        },
        "학과정보": {
            "인문대학": ["국어국문학과", "영어영문학과", "철학과", "역사학과", "언어학과"],
            "사회과학대학": ["정치외교학부", "경제학부", "사회학과", "심리학과", "언론정보학과"],
            "자연과학대학": ["수리과학부", "물리학과", "화학부", "생명과학부", "지구환경과학부"],
            "공과대학": ["컴퓨터공학부", "전기정보공학부", "기계공학부", "화학생물공학부", "건축학과"],
            "경영대학": ["경영학과"]
        }
    },

    "고려대": {
        "모집요강": {
            "2026학년도": {
                "수시": {
                    "학교추천전형": {
                        "모집인원": 1100,
                        "지원자격": "고교 추천 4% 이내",
                        "전형방법": "교과 80% + 서류 20%",
                        "수능최저": "인문 3개합 6 / 자연 3개합 7"
                    },
                    "일반전형": {
                        "모집인원": 1200,
                        "지원자격": "제한 없음",
                        "전형방법": "1단계: 서류 100% (5배수) / 2단계: 서류 70% + 면접 30%",
                        "수능최저": "없음"
                    }
                },
                "정시": {
                    "일반전형": {
                        "모집인원": 980,
                        "전형방법": "수능 100%",
                        "수능반영": "국어 35%, 수학 35%, 탐구 30% (영어 등급별 가감점)"
                    }
                }
            }
        },
        "입결": {
            "2025학년도": {
                "수시": {
                    "학교추천전형": {
                        "인문계열": {"평균내신": 2.1, "경쟁률": 3.5},
                        "자연계열": {"평균내신": 2.3, "경쟁률": 3.0},
                        "경영대학": {"평균내신": 1.8, "경쟁률": 4.2}
                    },
                    "일반전형": {
                        "인문계열": {"평균내신": 1.8, "경쟁률": 12.5},
                        "자연계열": {"평균내신": 2.0, "경쟁률": 10.2},
                        "경영대학": {"평균내신": 1.5, "경쟁률": 18.3}
                    }
                },
                "정시": {
                    "인문계열": {"평균백분위": 95.5, "경쟁률": 2.5},
                    "자연계열": {"평균백분위": 94.8, "경쟁률": 2.2},
                    "경영대학": {"평균백분위": 97.2, "경쟁률": 3.5}
                }
            }
        }
    },

    "연세대": {
        "모집요강": {
            "2026학년도": {
                "수시": {
                    "추천형": {
                        "모집인원": 660,
                        "지원자격": "고교 추천 인원 제한 없음",
                        "전형방법": "교과 60% + 서류 40%",
                        "수능최저": "인문 3개합 7 / 자연 3개합 8"
                    },
                    "활동우수형": {
                        "모집인원": 900,
                        "지원자격": "제한 없음",
                        "전형방법": "1단계: 서류 100% (3배수) / 2단계: 서류 60% + 면접 40%",
                        "수능최저": "없음"
                    }
                },
                "정시": {
                    "일반전형": {
                        "모집인원": 1050,
                        "전형방법": "수능 100%",
                        "수능반영": "국어 33.3%, 수학 33.3%, 탐구 33.3% (영어 감점)"
                    }
                }
            }
        },
        "입결": {
            "2025학년도": {
                "수시": {
                    "추천형": {
                        "인문계열": {"평균내신": 2.3, "경쟁률": 4.2},
                        "자연계열": {"평균내신": 2.5, "경쟁률": 3.8},
                        "경영대학": {"평균내신": 2.0, "경쟁률": 5.1}
                    },
                    "활동우수형": {
                        "인문계열": {"평균내신": 2.0, "경쟁률": 15.8},
                        "자연계열": {"평균내신": 2.2, "경쟁률": 12.5},
                        "경영대학": {"평균내신": 1.7, "경쟁률": 22.1}
                    }
                },
                "정시": {
                    "인문계열": {"평균백분위": 94.8, "경쟁률": 2.3},
                    "자연계열": {"평균백분위": 93.5, "경쟁률": 2.0},
                    "경영대학": {"평균백분위": 96.5, "경쟁률": 3.0}
                }
            }
        }
    }
}


# ============================================================
# 컨설팅 Agent용 데이터 (전국 대학 합격 데이터)
# ============================================================

# 수시 합격 데이터 (내신 기준)
ADMISSION_DATA_SUSI = {
    "학생부교과": {
        "서울대-지역균형": {"최저내신": 1.2, "평균내신": 1.7, "최고내신": 2.3},
        "고려대-학교추천": {"최저내신": 1.5, "평균내신": 2.1, "최고내신": 2.8},
        "연세대-추천형": {"최저내신": 1.8, "평균내신": 2.3, "최고내신": 3.0},
        "성균관대-학교장추천": {"최저내신": 1.8, "평균내신": 2.5, "최고내신": 3.2},
        "한양대-지역균형": {"최저내신": 2.0, "평균내신": 2.7, "최고내신": 3.5},
        "중앙대-학교장추천": {"최저내신": 2.2, "평균내신": 2.9, "최고내신": 3.8},
        "경희대-고교연계": {"최저내신": 2.5, "평균내신": 3.2, "최고내신": 4.0},
        "한국외대-학교장추천": {"최저내신": 2.3, "평균내신": 3.0, "최고내신": 3.8},
        "서울시립대-학교장추천": {"최저내신": 2.0, "평균내신": 2.8, "최고내신": 3.5},
        "건국대-KU학교추천": {"최저내신": 2.5, "평균내신": 3.3, "최고내신": 4.2}
    },
    "학생부종합": {
        "서울대-일반전형": {"최저내신": 1.0, "평균내신": 1.5, "최고내신": 2.5, "비고": "서류+면접 중요"},
        "고려대-일반전형": {"최저내신": 1.2, "평균내신": 1.8, "최고내신": 3.0, "비고": "서류+면접 중요"},
        "연세대-활동우수형": {"최저내신": 1.3, "평균내신": 2.0, "최고내신": 3.2, "비고": "비교과 중요"},
        "성균관대-계열모집": {"최저내신": 1.5, "평균내신": 2.2, "최고내신": 3.5, "비고": "서류 100%"},
        "한양대-일반": {"최저내신": 1.5, "평균내신": 2.3, "최고내신": 3.8, "비고": "서류 100%, 면접 없음"},
        "중앙대-다빈치형": {"최저내신": 1.8, "평균내신": 2.6, "최고내신": 4.0, "비고": "서류+면접"},
        "경희대-네오르네상스": {"최저내신": 2.0, "평균내신": 2.8, "최고내신": 4.2, "비고": "서류+면접"},
        "한국외대-면접형": {"최저내신": 2.0, "평균내신": 2.7, "최고내신": 4.0, "비고": "서류+면접"},
        "서울시립대-학생부종합": {"최저내신": 1.8, "평균내신": 2.5, "최고내신": 3.8, "비고": "서류+면접"},
        "건국대-KU자기추천": {"최저내신": 2.2, "평균내신": 3.0, "최고내신": 4.5, "비고": "서류+면접"}
    }
}

# 정시 합격 데이터 (백분위 기준)
ADMISSION_DATA_JEONGSI = {
    "가군": {
        "연세대-인문": {"최저백분위": 93, "평균백분위": 95.5, "최고백분위": 99},
        "연세대-자연": {"최저백분위": 91, "평균백분위": 94.2, "최고백분위": 98},
        "고려대-인문": {"최저백분위": 94, "평균백분위": 96.0, "최고백분위": 99},
        "고려대-자연": {"최저백분위": 92, "평균백분위": 95.0, "최고백분위": 98},
        "성균관대-인문": {"최저백분위": 90, "평균백분위": 93.5, "최고백분위": 97},
        "성균관대-자연": {"최저백분위": 88, "평균백분위": 92.0, "최고백분위": 96}
    },
    "나군": {
        "서울대-인문": {"최저백분위": 96, "평균백분위": 98.0, "최고백분위": 100},
        "서울대-자연": {"최저백분위": 94, "평균백분위": 97.0, "최고백분위": 100},
        "한양대-인문": {"최저백분위": 88, "평균백분위": 91.5, "최고백분위": 96},
        "한양대-자연": {"최저백분위": 86, "평균백분위": 90.0, "최고백분위": 95},
        "중앙대-인문": {"최저백분위": 85, "평균백분위": 89.0, "최고백분위": 94},
        "중앙대-자연": {"최저백분위": 82, "평균백분위": 87.0, "최고백분위": 93}
    },
    "다군": {
        "경희대-인문": {"최저백분위": 83, "평균백분위": 87.5, "최고백분위": 93},
        "경희대-자연": {"최저백분위": 80, "평균백분위": 85.0, "최고백분위": 91},
        "한국외대-인문": {"최저백분위": 85, "평균백분위": 88.5, "최고백분위": 94},
        "건국대-인문": {"최저백분위": 82, "평균백분위": 86.0, "최고백분위": 92},
        "건국대-자연": {"최저백분위": 78, "평균백분위": 83.5, "최고백분위": 90},
        "동국대-인문": {"최저백분위": 80, "평균백분위": 84.5, "최고백분위": 91}
    }
}

# 점수 환산 방법
SCORE_CONVERSION = {
    "서울대": {
        "정시": {
            "국어": {"반영비율": 33.3, "계산": "표준점수 사용"},
            "수학": {"반영비율": 40.0, "계산": "표준점수 사용"},
            "탐구": {"반영비율": 26.7, "계산": "표준점수 사용, 2과목 평균"},
            "영어": {"등급별가산점": {1: 0, 2: -0.5, 3: -1, 4: -1.5, 5: -2, 6: -2.5}}
        }
    },
    "고려대": {
        "정시": {
            "국어": {"반영비율": 35.0, "계산": "표준점수 사용"},
            "수학": {"반영비율": 35.0, "계산": "표준점수 사용"},
            "탐구": {"반영비율": 30.0, "계산": "백분위 사용, 2과목 평균"},
            "영어": {"등급별가감점": {1: 100, 2: 98, 3: 95, 4: 90, 5: 80}}
        }
    },
    "연세대": {
        "정시": {
            "국어": {"반영비율": 33.3, "계산": "백분위 사용"},
            "수학": {"반영비율": 33.3, "계산": "백분위 사용"},
            "탐구": {"반영비율": 33.3, "계산": "백분위 사용, 2과목 평균"},
            "영어": {"등급별감점": {1: 0, 2: -5, 3: -10, 4: -15, 5: -20}}
        }
    }
}


# ============================================================
# DB 조회 함수들
# ============================================================

def get_university_info(university: str, category: str = None) -> dict:
    """대학별 정보 조회"""
    if university not in UNIVERSITY_DATA:
        return {"error": f"{university} 정보가 없습니다."}

    data = UNIVERSITY_DATA[university]
    if category and category in data:
        return {university: {category: data[category]}}
    return {university: data}


def get_admission_data_by_grade(grade: float, admission_type: str = "전체") -> dict:
    """내신 등급 기준 합격 가능 대학 조회"""
    result = {"합격가능": [], "도전가능": [], "상향지원": []}

    data_sources = []
    if admission_type in ["전체", "학생부교과"]:
        data_sources.append(("학생부교과", ADMISSION_DATA_SUSI.get("학생부교과", {})))
    if admission_type in ["전체", "학생부종합"]:
        data_sources.append(("학생부종합", ADMISSION_DATA_SUSI.get("학생부종합", {})))

    for type_name, data in data_sources:
        for univ_type, values in data.items():
            avg = values.get("평균내신", 0)
            max_grade = values.get("최고내신", 0)

            if grade <= avg:
                result["합격가능"].append({
                    "전형": f"{type_name}-{univ_type}",
                    "평균내신": avg,
                    "내등급과차이": round(avg - grade, 2)
                })
            elif grade <= max_grade:
                result["도전가능"].append({
                    "전형": f"{type_name}-{univ_type}",
                    "평균내신": avg,
                    "최고내신": max_grade,
                    "내등급과차이": round(avg - grade, 2)
                })
            elif grade <= max_grade + 0.5:
                result["상향지원"].append({
                    "전형": f"{type_name}-{univ_type}",
                    "평균내신": avg,
                    "최고내신": max_grade,
                    "내등급과차이": round(avg - grade, 2)
                })

    # 정렬
    for key in result:
        result[key] = sorted(result[key], key=lambda x: x.get("평균내신", 0))

    return result


def get_jeongsi_data_by_percentile(percentile: float) -> dict:
    """백분위 기준 정시 합격 가능 대학 조회"""
    result = {"합격가능": [], "도전가능": [], "상향지원": []}

    for group, universities in ADMISSION_DATA_JEONGSI.items():
        for univ_type, values in universities.items():
            avg = values.get("평균백분위", 0)
            min_pct = values.get("최저백분위", 0)

            if percentile >= avg:
                result["합격가능"].append({
                    "군": group,
                    "대학-계열": univ_type,
                    "평균백분위": avg,
                    "내백분위와차이": round(percentile - avg, 1)
                })
            elif percentile >= min_pct:
                result["도전가능"].append({
                    "군": group,
                    "대학-계열": univ_type,
                    "평균백분위": avg,
                    "최저백분위": min_pct,
                    "내백분위와차이": round(percentile - avg, 1)
                })
            elif percentile >= min_pct - 2:
                result["상향지원"].append({
                    "군": group,
                    "대학-계열": univ_type,
                    "평균백분위": avg,
                    "최저백분위": min_pct,
                    "내백분위와차이": round(percentile - avg, 1)
                })

    return result


def get_score_conversion_info(university: str) -> dict:
    """대학별 점수 환산 방법 조회"""
    if university in SCORE_CONVERSION:
        return {university: SCORE_CONVERSION[university]}
    return {"error": f"{university} 점수 환산 정보가 없습니다."}
